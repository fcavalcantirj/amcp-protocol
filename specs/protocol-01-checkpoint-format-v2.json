{
  "category": "amcp-protocol",
  "description": "Checkpoint format v2 - encrypted, signed, chain continuity",
  "steps": [
    "Header (plaintext JSON):",
    "  { version: 2, aid, parentAID?, timestamp, previousCID, resurrectFromCID?, signature }",
    "  signature: Ed25519 signature of encrypted payload (proves authenticity)",
    "aid: this agent's identity (cryptographic boundary)",
    "parentAID: spawning parent's AID (null for genesis/master agents)",
    "previousCID: links to prior checkpoint (chain continuity within this agent)",
    "resurrectFromCID: set after resurrection (marks fork point)",
    "Encrypted payload structure:",
    "  { content: { soul, memory, files }, secrets: [...] }",
    "Content: soul (SOUL.md), memory (MEMORY.md), files (pathâ†’content map)",
    "Secrets: [{ key, value, type, targets }]",
    "Secret types: api_key, token, jwt, credential, env_var",
    "Secret targets: [{ kind: 'file'|'env'|'systemd', path?, jsonPath?, name?, service? }]",
    "Payload encrypted with AES-256-GCM (key from AMCP private key)",
    "Signature created with Ed25519 private key over encrypted payload",
    "File format: JSON(header) + '\\n---\\n' + base64(encrypted_payload)",
    "Verify: Header readable (aid, timestamp, signature visible)",
    "Verify: Signature verifiable with public key (derived from AID)",
    "Verify: Payload unreadable without private key",
    "Verify: Invalid signature = reject checkpoint (not authentic)"
  ],
  "passes": false
}
