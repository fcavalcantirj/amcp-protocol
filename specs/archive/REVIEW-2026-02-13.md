# AMCP Complete Review â€” 2026-02-13

## Vision

**Spawn N agents. Each has isolated, encrypted, verifiable memories. Parent can't read child. Child can't read parent. All in the same lineage tree. Knowledge compounds via Solvr.**

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AMCP PROTOCOL                            â”‚
â”‚                    (library - the "what")                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  identity create    checkpoint create    resuscitate    verify  â”‚
â”‚       â†“                    â†“                  â†“           â†“     â”‚
â”‚  Ed25519 keypair    encrypt+sign      verify+decrypt   sig only â”‚
â”‚  AID = B+pubkey     AES-256-GCM       check AID first  no key   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PROACTIVE-AMCP SKILL                        â”‚
â”‚                   (enforcer - the "when/who")                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  watchdog        auto-checkpoint      secrets-inject    notify  â”‚
â”‚     â†“                  â†“                    â†“             â†“     â”‚
â”‚  detect death    periodic backup     file/env/systemd  Telegram â”‚
â”‚  recovery flow   IPFS pinning        after resuscitate  + email â”‚
â”‚                                                                 â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                     â”‚    SOLVR     â”‚                            â”‚
â”‚                     â”‚  integration â”‚                            â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                     search before recovery                      â”‚
â”‚                     log approach/outcome                        â”‚
â”‚                     knowledge compounds                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Protocol Specs (8 total)

| # | Spec | Description | Implementation |
|---|------|-------------|----------------|
| 00 | identity-create | Generate AID + Ed25519 keypair | âœ… CLI done |
| 01 | checkpoint-format-v2 | Header + encrypted payload format | âœ… CLI done |
| 02 | encryption | AES-256-GCM, HKDF key derivation | âœ… CLI done |
| 03 | signature | Ed25519 sign/verify | âœ… CLI done |
| 04 | checkpoint-create | Encrypt + sign + format | âœ… CLI done |
| 05 | resuscitate | Verify â†’ decrypt â†’ return | âœ… CLI done |
| 06 | memory-isolation | Parent/child isolation guarantees | âœ… Tested |
| 07 | verification | Third-party verify without decrypt | âœ… CLI done |

**Protocol Status: COMPLETE âœ…**

CLI: `~/bin/amcp` (identity create/show, checkpoint create, resuscitate, verify)

---

## Skill Specs (8 total)

| # | Spec | Description | Implementation |
|---|------|-------------|----------------|
| 01 | structure | SKILL.md + scripts, ClawdHub publish | âŒ Not started |
| 02 | secrets-injection | file/env/systemd targets | âŒ Not started |
| 03 | watchdog | Self-monitoring, recovery hierarchy | âŒ Not started |
| 04 | solvr-integration | Search before, log approaches | âŒ Not started |
| 05 | resurrection | Full recovery flow | âŒ Not started |
| 06 | notifications | Telegram + email | âŒ Not started |
| 07 | auto-checkpoint | Periodic backup, IPFS pin | âŒ Not started |
| 08 | spawn-child | Isolated identity on deploy | âŒ Not started |

**Skill Status: SPECS DONE, IMPLEMENTATION NEEDED**

---

## Future Specs (3 total â€” post-v1)

| # | Spec | Description |
|---|------|-------------|
| 01 | key-rotation | Pre-rotation, chain of trust |
| 02 | revocation | Identity revocation records |
| 03 | conflict-prevention | Detect conflicts, alert |

**Future: Documented for later, not blocking v1**

---

## Memory Isolation Guarantees

### Enforcement Points

1. **AID Check (resuscitate step 3)**
   ```
   if header.aid !== identity.aid â†’ REJECT "not my checkpoint"
   ```

2. **Encryption**
   - Payload encrypted with owner's HKDF-derived key
   - Even bypassing AID check â†’ can't decrypt without private key

3. **Signature**
   - Only key holder can create valid signature
   - Verify BEFORE decrypt â†’ reject fake/tampered checkpoints

### What This Means

| Scenario | Result |
|----------|--------|
| Parent loads child's checkpoint | âŒ AID mismatch |
| Child loads parent's checkpoint | âŒ AID mismatch |
| Bypass AID check | âŒ Can't decrypt (wrong key) |
| Attacker injects fake checkpoint | âŒ Signature invalid |
| Third party verifies | âœ… Can verify without decrypting |

---

## Chain Structure (Memory Tree)

```
Claudius (AID-A, parentAID: null)     â† Genesis/master
â”œâ”€â”€ [ckpt-A1] â†’ [ckpt-A2] â†’ [ckpt-A3] â†’ ...
â”‚
â”œâ”€â”€ Jack (AID-B, parentAID: AID-A)    â† Child
â”‚   â””â”€â”€ [ckpt-B1] â†’ [ckpt-B2] â†’ ...
â”‚
â””â”€â”€ Bruce (AID-C, parentAID: AID-A)   â† Child
    â””â”€â”€ [ckpt-C1] â†’ [ckpt-C2] â†’ ...
```

- `previousCID`: Links within SAME agent's chain
- `parentAID`: Tracks lineage (metadata only, no access)
- `resurrectFromCID`: Marks fork after resurrection

---

## Implementation Tasks

### Phase 1: Skill Structure âœ…â†’âŒ
```
[ ] Create skills/proactive-amcp/SKILL.md
[ ] Define triggers: amcp, checkpoint, resurrect, death, rehydrate
[ ] Config schema in openclaw.json
```

### Phase 2: Auto-Checkpoint
```
[ ] scripts/checkpoint.sh
    - Read SOUL.md, MEMORY.md, memory/*.md
    - Extract secrets from openclaw.json, auth-profiles.json
    - Call amcp checkpoint create
    - Pin to IPFS via Pinata
    - Update ~/.amcp/last-checkpoint.json
    - Track previousCID for chain
[ ] Cron job or heartbeat piggyback
[ ] Rotation: keep last N, unpin old
```

### Phase 3: Secrets Injection
```
[ ] scripts/inject-secrets.sh
    - Parse secrets JSON from resuscitate output
    - Handle kind='file': write to JSON at jsonPath
    - Handle kind='env': append to ~/.bashrc
    - Handle kind='systemd': update service Environment
    - Backup before modify
    - Reload systemd if needed
```

### Phase 4: Watchdog
```
[ ] scripts/watchdog.sh
    - Health check: gateway responding? memory ok? disk ok?
    - State machine: HEALTHY â†’ CHECKING â†’ DEAD
    - Recovery hierarchy:
      1. Restart gateway
      2. Fix config from last good
      3. Rehydrate from checkpoint
      4. Deploy new VM (LAST RESORT)
    - Notify on each state change
```

### Phase 5: Resurrection Flow
```
[ ] scripts/resuscitate.sh (orchestrator)
    - Fetch checkpoint from IPFS
    - Call amcp resuscitate
    - Call inject-secrets.sh
    - Restart gateway
    - Verify health
    - Notify success/failure
[ ] Solvr integration:
    - Search before recovery
    - POST approach before each step
    - POST outcome after each step
```

### Phase 6: Notifications
```
[ ] Telegram via OpenClaw message tool
[ ] Email via gog or AgentMail
[ ] Templates for each event type
```

### Phase 7: Integration
```
[ ] Test full flow: checkpoint â†’ kill â†’ resurrect â†’ verify
[ ] Test memory isolation: parent can't load child checkpoint
[ ] Test chain continuity: previousCID links correctly
[ ] Publish to ClawdHub
```

---

## Gaps Identified

### Protocol: NONE âœ…
All 8 specs implemented and tested.

### Skill: ALL IMPLEMENTATION PENDING
Specs are complete. Need to write the actual scripts.

### Questions Resolved

| Question | Answer |
|----------|--------|
| Who runs watchdog? | Each agent runs their own |
| Who triggers resurrection? | Self (watchdog) or parent (for dead VM) |
| Where do secrets go? | file/env/systemd targets defined in checkpoint |
| How is Solvr used? | Enforced by SKILL.md prompt in Claude Code |
| How is IPFS used? | Pinata for pinning, gateway for fetch |

---

## Summary

| Component | Specs | Implementation |
|-----------|-------|----------------|
| Protocol | 8/8 âœ… | 8/8 âœ… (CLI done) |
| Skill | 8/8 âœ… | 0/8 âŒ (need scripts) |
| Future | 3/3 âœ… | Post-v1 |

**Next Step:** Build proactive-amcp skill scripts.

---

*Protocol is solid. Time to build the enforcer. ğŸ´â€â˜ ï¸*
